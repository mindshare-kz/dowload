<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Скачать фото из таблицы</title>
</head>
<body>
  <h2>Скачать фото из таблицы</h2>
  <button id="download">Скачать архив</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script>
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQGLXlcLn4jmhStOduOZeWL_ZnholxbZ-yDyBzJ8_U_vh789brxlEMg0Jcw4Unzhjr9Di3m8AUlWlO-/pub?gid=0&single=true&output=csv";

    // функция вытаскивания ID файла из ссылки
    function extractFileId(url) {
      const match = url.match(/[-\w]{25,}/);
      return match ? match[0] : null;
    }

    document.getElementById("download").addEventListener("click", async () => {
      const response = await fetch(sheetUrl);
      const csv = await response.text();

      const rows = csv.split("\n").map(r => r.split(","));
      const zip = new JSZip();

      // идём по строкам, берём 8-ю колонку (H)
      for (let i = 1; i < rows.length; i++) { // i=1 чтобы пропустить заголовок
        const link = rows[i][7]; // H = 8-я колонка (индекс 7)
        if (!link) continue;

        const fileId = extractFileId(link);
        if (!fileId) continue;

        const fileUrl = `https://drive.google.com/uc?export=download&id=${fileId}`;
        try {
          const imgResp = await fetch(fileUrl);
          const blob = await imgResp.blob();
          zip.file(`${i}.jpg`, blob); // имя файла = номер строки
        } catch (e) {
          console.error("Ошибка загрузки", link, e);
        }
      }

      const content = await zip.generateAsync({ type: "blob" });
      saveAs(content, "photos.zip");
    });
  </script>
</body>
</html>
